(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[180],{8752:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat",function(){return n(7954)}])},463:function(e,t,n){"use strict";var r=n(9669),s=n.n(r)().create({baseURL:"https://tasker-01.herokuapp.com/api"});t.Z=s},7954:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return h}});var r=n(5893),s=n(7294),o=n(463),a=function(e){var t=e.conversation,n=e.currentUser,a=(0,s.useState)(null),i=a[0],c=a[1];return(0,s.useEffect)((function(){var e=null===t||void 0===t?void 0:t.members.find((function(e){return e!==n._id}));console.log(e,"this id friend id"),o.Z.get("/users?userId="+e).then((function(e){console.log(e.data,"this is datatatatatatatta"),c(e.data)})).catch((function(e){return console.log(e)}))}),[n,t]),(0,r.jsxs)("div",{className:"conversation",children:[(0,r.jsx)("img",{className:"conversationImg",src:"https://thumbs.dreamstime.com/b/default-avatar-profile-image-vector-social-media-user-icon-potrait-182347582.jpg"}),(0,r.jsx)("span",{className:"conversationName",children:null===i||void 0===i?void 0:i.name})]})},i=n(2165),c=function(e){var t=e.message,n=e.own;return(0,r.jsxs)("div",{className:n?"message own":"message",children:[(0,r.jsxs)("div",{className:"messageTop",children:[(0,r.jsx)("img",{className:"messageImg",src:"https://images.pexels.com/photos/3686769/pexels-photo-3686769.jpeg?auto=compress&cs=tinysrgb&dpr=2&w=500",alt:""}),(0,r.jsx)("p",{className:"messageText",children:t.text})]}),(0,r.jsx)("div",{className:"messageBottom",children:(0,i.WU)(t.createdAt)})]})},u=n(5617),l=n(1157);function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function f(e){return function(e){if(Array.isArray(e))return d(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var v=function(){var e=(0,s.useState)([]),t=e[0],n=e[1],i=(0,s.useState)(null),d=i[0],v=i[1],m=(0,s.useState)([]),h=m[0],p=m[1],g=(0,s.useState)(""),x=g[0],j=g[1],N=(0,s.useState)(null),b=N[0],_=N[1],w=(0,s.useState)([]),y=(w[0],w[1]),S=(0,s.useRef)(),E=(0,s.useRef)(),k=(0,u.v9)((function(e){return e.user.userData}));(0,s.useEffect)((function(){S.current=(0,l.io)("https://tasker-01.herokuapp.com",{transports:["websocket","polling","flashsocket"]}),S.current.on("getMessage",(function(e){_({sender:e.senderId,text:e.text,createdAt:Date.now()})}))}),[]),(0,s.useEffect)((function(){b&&(null===d||void 0===d?void 0:d.members.includes(b.sender))&&p((function(e){return f(e).concat([b])}))}),[b,d]),(0,s.useEffect)((function(){S.current.emit("addUser",null===k||void 0===k?void 0:k._id),S.current.on("getUsers",(function(e){y(e)}))}),[k]),(0,s.useEffect)((function(){o.Z.get("/conversation/"+(null===k||void 0===k?void 0:k._id)).then((function(e){n(null===e||void 0===e?void 0:e.data)})).catch((function(e){return console.log(e)}))}),[null===k||void 0===k?void 0:k._id]),(0,s.useEffect)((function(){o.Z.get("/messages/"+(null===d||void 0===d?void 0:d._id)).then((function(e){p(e.data)})).catch((function(e){return console.log(e)}))}),[d]);return(0,s.useEffect)((function(){var e;null===(e=E.current)||void 0===e||e.scrollIntoView({behaviour:"smooth"})}),[h]),(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"messenger",children:[(0,r.jsx)("div",{className:"chatMenu",children:(0,r.jsx)("div",{className:"chatMenuWrapper",children:t.map((function(e,t){return(0,r.jsx)("div",{onClick:function(){return v(e)},children:(0,r.jsx)(a,{conversation:e,currentUser:k})},t)}))})}),(0,r.jsx)("div",{className:"chatBox",children:(0,r.jsx)("div",{className:"chatBoxWrapper",children:d?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"chatBoxTop",children:null===h||void 0===h?void 0:h.map((function(e,t){return(0,r.jsx)("div",{ref:E,children:(0,r.jsx)(c,{message:e,own:e.sender===(null===k||void 0===k?void 0:k._id)})},t)}))}),(0,r.jsxs)("div",{className:"chatBoxBottom",children:[(0,r.jsx)("textarea",{className:"chatMessageInput",placeholder:"write something...",onChange:function(e){return j(e.target.value)},value:x}),(0,r.jsx)("button",{className:"chatSubmitButton",onClick:function(e){e.preventDefault();var t=null===d||void 0===d?void 0:d.members.find((function(e){return e!==(null===k||void 0===k?void 0:k._id)})),n={sender:null===k||void 0===k?void 0:k._id,text:x,conversationId:null===d||void 0===d?void 0:d._id};o.Z.post("/messages",n).then((function(e){var n;p(f(h).concat([e.data])),j(""),null===(n=S.current)||void 0===n||n.emit("sendMessage",{senderId:null===k||void 0===k?void 0:k._id,receiverId:t,text:x})})).catch((function(e){console.log(e)}))},children:"Send"})]})]}):(0,r.jsx)("span",{className:"noConversationText",children:"Open a conversation to start a chat."})})})]})})},m=n(5783),h=function(){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(m.Z,{}),(0,r.jsx)(v,{})]})}}},function(e){e.O(0,[669,748,774,888,179],(function(){return t=8752,e(e.s=t);var t}));var t=e.O();_N_E=t}]);